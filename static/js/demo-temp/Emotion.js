const emotionChart = echarts.init(document.getElementById("emotion"));

var emotiondata={"7": [["5-7", "5-8", "5-9", "5-10", "5-11", "5-12", "5-13"], [{"name": "Pos", "value": [10.610932475884244, 6.0, 8.6, 9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703]}, {"name": "Neu", "value": [64.30868167202573, 72.2, 71.4, 70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658]}, {"name": "Neg", "value": [25.080385852090032, 21.8, 20.0, 19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722]}]], "8": [["5-7", "5-8", "5-9", "5-10", "5-11", "5-12", "5-13"], [{"name": "Pos", "value": [10.610932475884244, 6.0, 8.6, 9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703]}, {"name": "Neu", "value": [64.30868167202573, 72.2, 71.4, 70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658]}, {"name": "Neg", "value": [25.080385852090032, 21.8, 20.0, 19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722]}]], "9": [["5-7", "5-8", "5-9", "5-10", "5-11", "5-12", "5-13"], [{"name": "Pos", "value": [10.610932475884244, 6.0, 8.6, 9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703]}, {"name": "Neu", "value": [64.30868167202573, 72.2, 71.4, 70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658]}, {"name": "Neg", "value": [25.080385852090032, 21.8, 20.0, 19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722]}]], "10": [["5-7", "5-8", "5-9", "5-10", "5-11", "5-12", "5-13"], [{"name": "Pos", "value": [10.610932475884244, 6.0, 8.6, 9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703]}, {"name": "Neu", "value": [64.30868167202573, 72.2, 71.4, 70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658]}, {"name": "Neg", "value": [25.080385852090032, 21.8, 20.0, 19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722]}]], "11": [["5-8", "5-9", "5-10", "5-11", "5-12", "5-13", "5-14"], [{"name": "Pos", "value": [6.0, 8.6, 9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703, 8.092485549132949]}, {"name": "Neu", "value": [72.2, 71.4, 70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658, 72.13872832369943]}, {"name": "Neg", "value": [21.8, 20.0, 19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722, 19.76878612716763]}]], "12": [["5-9", "5-10", "5-11", "5-12", "5-13", "5-14", "5-15"], [{"name": "Pos", "value": [8.6, 9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703, 8.092485549132949, 10.824295010845987]}, {"name": "Neu", "value": [71.4, 70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658, 72.13872832369943, 69.24078091106291]}, {"name": "Neg", "value": [20.0, 19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722, 19.76878612716763, 19.934924078091107]}]], "13": [["5-10", "5-11", "5-12", "5-13", "5-14", "5-15", "5-16"], [{"name": "Pos", "value": [9.4, 12.514757969303425, 9.44206008583691, 10.103806228373703, 8.092485549132949, 10.824295010845987, 8.966043494849295]}, {"name": "Neu", "value": [70.8, 60.44864226682409, 63.94849785407725, 67.47404844290658, 72.13872832369943, 69.24078091106291, 75.77260587561999]}, {"name": "Neg", "value": [19.8, 27.03659976387249, 26.609442060085836, 22.422145328719722, 19.76878612716763, 19.934924078091107, 15.261350629530714]}]], "14": [["5-11", "5-12", "5-13", "5-14", "5-15", "5-16", "5-17"], [{"name": "Pos", "value": [12.514757969303425, 9.44206008583691, 10.103806228373703, 8.092485549132949, 10.824295010845987, 8.966043494849295, 7.838565022421525]}, {"name": "Neu", "value": [60.44864226682409, 63.94849785407725, 67.47404844290658, 72.13872832369943, 69.24078091106291, 75.77260587561999, 77.43497757847534]}, {"name": "Neg", "value": [27.03659976387249, 26.609442060085836, 22.422145328719722, 19.76878612716763, 19.934924078091107, 15.261350629530714, 14.72645739910314]}]], "15": [["5-12", "5-13", "5-14", "5-15", "5-16", "5-17", "5-18"], [{"name": "Pos", "value": [9.44206008583691, 10.103806228373703, 8.092485549132949, 10.824295010845987, 8.966043494849295, 7.838565022421525, 10.572139303482587]}, {"name": "Neu", "value": [63.94849785407725, 67.47404844290658, 72.13872832369943, 69.24078091106291, 75.77260587561999, 77.43497757847534, 71.96162046908316]}, {"name": "Neg", "value": [26.609442060085836, 22.422145328719722, 19.76878612716763, 19.934924078091107, 15.261350629530714, 14.72645739910314, 17.46624022743426]}]], "16": [["5-13", "5-14", "5-15", "5-16", "5-17", "5-18", "5-19"], [{"name": "Pos", "value": [10.103806228373703, 8.092485549132949, 10.824295010845987, 8.966043494849295, 7.838565022421525, 10.572139303482587, 9.788602941176471]}, {"name": "Neu", "value": [67.47404844290658, 72.13872832369943, 69.24078091106291, 75.77260587561999, 77.43497757847534, 71.96162046908316, 72.0281862745098]}, {"name": "Neg", "value": [22.422145328719722, 19.76878612716763, 19.934924078091107, 15.261350629530714, 14.72645739910314, 17.46624022743426, 18.183210784313726]}]], "17": [["5-14", "5-15", "5-16", "5-17", "5-18", "5-19", "5-20"], [{"name": "Pos", "value": [8.092485549132949, 10.824295010845987, 8.966043494849295, 7.838565022421525, 10.572139303482587, 9.788602941176471, 9.635267087880528]}, {"name": "Neu", "value": [72.13872832369943, 69.24078091106291, 75.77260587561999, 77.43497757847534, 71.96162046908316, 72.0281862745098, 75.22975301550832]}, {"name": "Neg", "value": [19.76878612716763, 19.934924078091107, 15.261350629530714, 14.72645739910314, 17.46624022743426, 18.183210784313726, 15.134979896611142]}]], "18": [["5-15", "5-16", "5-17", "5-18", "5-19", "5-20", "5-21"], [{"name": "Pos", "value": [10.824295010845987, 8.966043494849295, 7.838565022421525, 10.572139303482587, 9.788602941176471, 9.635267087880528, 10.017044709584372]}, {"name": "Neu", "value": [69.24078091106291, 75.77260587561999, 77.43497757847534, 71.96162046908316, 72.0281862745098, 75.22975301550832, 72.6629080896814]}, {"name": "Neg", "value": [19.934924078091107, 15.261350629530714, 14.72645739910314, 17.46624022743426, 18.183210784313726, 15.134979896611142, 17.320047200734233]}]], "19": [["5-16", "5-17", "5-18", "5-19", "5-20", "5-21", "5-22"], [{"name": "Pos", "value": [8.966043494849295, 7.838565022421525, 10.572139303482587, 9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812]}, {"name": "Neu", "value": [75.77260587561999, 77.43497757847534, 71.96162046908316, 72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477]}, {"name": "Neg", "value": [15.261350629530714, 14.72645739910314, 17.46624022743426, 18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749]}]], "20": [["5-17", "5-18", "5-19", "5-20", "5-21", "5-22", "5-23"], [{"name": "Pos", "value": [7.838565022421525, 10.572139303482587, 9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812, 9.72772931535818]}, {"name": "Neu", "value": [77.43497757847534, 71.96162046908316, 72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477, 77.24028548770816]}, {"name": "Neg", "value": [14.72645739910314, 17.46624022743426, 18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749, 13.03198519693365]}]], "21": [["5-18", "5-19", "5-20", "5-21", "5-22", "5-23", "5-24"], [{"name": "Pos", "value": [10.572139303482587, 9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812, 9.72772931535818, 9.220140826358444]}, {"name": "Neu", "value": [71.96162046908316, 72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477, 77.24028548770816, 79.52703600371994]}, {"name": "Neg", "value": [17.46624022743426, 18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749, 13.03198519693365, 11.252823169921616]}]], "22": [["5-19", "5-20", "5-21", "5-22", "5-23", "5-24", "5-25"], [{"name": "Pos", "value": [9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812, 9.72772931535818, 9.220140826358444, 9.600421996571278]}, {"name": "Neu", "value": [72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477, 77.24028548770816, 79.52703600371994, 76.0780693656864]}, {"name": "Neg", "value": [18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749, 13.03198519693365, 11.252823169921616, 14.321508637742319]}]], "23": [["5-19", "5-20", "5-21", "5-22", "5-23", "5-24", "5-25"], [{"name": "Pos", "value": [9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812, 9.72772931535818, 9.220140826358444, 9.600421996571278]}, {"name": "Neu", "value": [72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477, 77.24028548770816, 79.52703600371994, 76.0780693656864]}, {"name": "Neg", "value": [18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749, 13.03198519693365, 11.252823169921616, 14.321508637742319]}]], "24": [["5-19", "5-20", "5-21", "5-22", "5-23", "5-24", "5-25"], [{"name": "Pos", "value": [9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812, 9.72772931535818, 9.220140826358444, 9.600421996571278]}, {"name": "Neu", "value": [72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477, 77.24028548770816, 79.52703600371994, 76.0780693656864]}, {"name": "Neg", "value": [18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749, 13.03198519693365, 11.252823169921616, 14.321508637742319]}]], "25": [["5-19", "5-20", "5-21", "5-22", "5-23", "5-24", "5-25"], [{"name": "Pos", "value": [9.788602941176471, 9.635267087880528, 10.017044709584372, 9.296548117154812, 9.72772931535818, 9.220140826358444, 9.600421996571278]}, {"name": "Neu", "value": [72.0281862745098, 75.22975301550832, 72.6629080896814, 76.1244769874477, 77.24028548770816, 79.52703600371994, 76.0780693656864]}, {"name": "Neg", "value": [18.183210784313726, 15.134979896611142, 17.320047200734233, 14.57897489539749, 13.03198519693365, 11.252823169921616, 14.321508637742319]}]]}

function emotion(time_str){

    var source_data=emotiondata[time_str];

    var weekDay = 0;
    var data = [source_data[1][1], source_data[1][2], source_data[1][0]]

    option = {
        tooltip: {
            trigger: 'item',
            padding: 10,
            backgroundColor: '#222',
            borderColor: '#777',
            borderWidth: 1,
            formatter: tooltipFormatter,

        },
        angleAxis: {
            type: 'category',
            data: source_data[0],
            z: 10,
            axisLabel: {
                fontSize: 10,
                interval: 0,
                textStyle: {
                    color: '#ddd'
                }}
        },
        polar: {
            center: ['50%', '50%'],
            radius: 115,
        },
        radiusAxis: {},
        series: [{
            type: 'bar',
            data: [
                data["0"].value["0"],
                data["0"].value["1"],
                data["0"].value["2"],
                data["0"].value["3"],
                data["0"].value["4"],
                data["0"].value["5"],
                data["0"].value["6"],
            ],
            coordinateSystem: 'polar',
            name: data["0"].name,
            stack: 'a',
            itemStyle: {
                normal: {
                    borderWidth: 4,
                    borderColor: '#ffffff',
                },
                emphasis: {
                    borderWidth: 0,
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }, {
            type: 'bar',
            data: [
                data["1"].value["0"],
                data["1"].value["1"],
                data["1"].value["2"],
                data["1"].value["3"],
                data["1"].value["4"],
                data["1"].value["5"],
                data["1"].value["6"],
            ],
            coordinateSystem: 'polar',
            name: data["1"].name,
            stack: 'a',
            itemStyle: {
                normal: {
                    borderWidth: 4,
                    borderColor: '#ffffff',
                },
                emphasis: {
                    borderWidth: 0,
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }, {
            type: 'bar',
            data: [
                data["2"].value["0"],
                data["2"].value["1"],
                data["2"].value["2"],
                data["2"].value["3"],
                data["2"].value["4"],
                data["2"].value["5"],
                data["2"].value["6"],
            ],
            coordinateSystem: 'polar',
            name: data["2"].name,
            stack: 'a',
            itemStyle: {
                normal: {
                    borderWidth: 3,
                    borderColor: '#ffffff',
                },
                emphasis: {
                    borderWidth: 3,
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }, {
            name: 'Emotion',
            type: 'pie',
            radius: ['75%', '80%'],
            avoidLabelOverlap: false,
            label: {
                normal: {
                    show: true,
                    position: 'outside',
                    formatter: '{b}'

                },
                emphasis: {
                    show: true,
                    textStyle: {
                        fontSize: '15',
                        fontWeight: 'normal'
                    }
                }
            },
            labelLine: {
                normal: {
                    show: false
                }
            },
            data: [{
                value: data["0"].value["0"],
                name: data["0"].name
            }, {
                value: data["1"].value["0"],
                name: data["1"].name
            }, {
                value: data["2"].value["0"],
                name: data["2"].name
            }],
            legend: {
                show: true,
                orient: 'vertical',
                x: 'right',
                y: 'top',
                data: [data["0"].name, data["1"].name, data["2"].name, ]
            },
            itemStyle: {
                normal: {
                    borderWidth: 3,
                    borderColor: '#ffffff',
                },
                emphasis: {
                    borderWidth: 3,
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }]
    }

    function tooltipFormatter(params) {
        var valuesFormatter = [];
        if (params.componentSubType == 'pie') {
            valuesFormatter.push(
                '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">' +
                option.angleAxis.data[weekDay].value + '<br>' + '</div>' +
                '<span style="color:' + params.color + '">' + params.name + '</span>: ' + params.value
            );
        } else {
            valuesFormatter.push(
                '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">' +
                params.seriesName +
                '</div>' +
                '<span style="color:' + params.color + '">' + params.name + '</span>: ' + params.value + '<br>');
        }

        return valuesFormatter;
    }
    emotionChart.setOption(option);
}

window.onresize = function() {
    emotionChart.resize();
};

emotionChart.on('click', function(params) {
    if (params.componentSubType != 'pie') {
        weekDay = params.dataIndex;
        option.series[3].data[0].value = data[0].value[weekDay];
        option.series[3].data[1].value = data[1].value[weekDay];
        option.series[3].data[2].value = data[2].value[weekDay];
        var weekDayData = ['星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期日'];;
        weekDayData[weekDay] = {
            value: weekDayData[weekDay],
            textStyle: {
                fontSize: 25,
            }
        };
        option.angleAxis.data = weekDayData;
        emotionChart.setOption(option);
    }
});